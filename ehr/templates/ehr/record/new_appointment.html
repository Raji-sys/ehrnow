{% extends 'base.html'%}
{% load static %}
{%block title%}NEW APPOINTMENT{%endblock%}
{%block page_title%}<div class="flex justify-center">NEW APPOINTMENT</div>{%endblock%}
{%block content %}
<div class="">
    <div class="mt-4 mx-auto w-fit rounded-xl bg-white">
        {% if form.errors %}
        <div class="uk-alert-danger block text-xs uppercase text-rose-700 rounded-xl" uk-alert>
            <a href class="uk-alert-close font-bold" uk-close></a>
            <p>{{form.errors}}</p>
        </div>
            {% endif %}
  <form id="appointment-form" method="post" enctype="multipart/form-data" class="text-xs">
    {% csrf_token %}
    <input type="hidden" name="confirm_override" id="confirm-override-input" value="">

    <div class="mb-2 uppercase text-cyan-900 mx-auto px-10">
        <div class="grid grid-cols-1 p-2 gap-4">
      {% for field in form %}
        <div>
            <div class="flex justify-start">
                <label for="{{field.id_for_label}}">{{ field.label_tag }}</label>
            </div>
            <div class="flex justify-start">
                {{ field }}
            </div>
            </div>
            {%endfor%}
        </div>
    </div>
    <div class="gap-4 flex justify-center align-middle p-3">
      <input type="submit" value="save" class="focus:opacity-10 uppercase focus:border-green-900 hover:bg-white hover:text-green-600 hover:border-2 hover:border-green-600
  bg-green-700 text-white py-4 px-8 rounded shadow-lg hover:shadow-xl">
    </div>
    </form>
    </div>
    </div>

<div id="conflict-modal" uk-modal>
    <div class="uk-modal-dialog uk-modal-body uk-margin-auto-vertical">
        <button class="uk-modal-close-default" type="button" uk-close></button>
        <h2 class="uk-modal-title text-red-600">Appointment Conflict!</h2>
        <p id="conflict-message" class="text-lg"></p>
        <p class="uk-text-right">
            <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
            <button class="uk-button uk-button-danger" type="button" id="proceed-anyway-btn">Proceed Anyway</button>
        </p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const conflictModal = UIkit.modal('#conflict-modal');
        const proceedAnywayBtn = document.getElementById('proceed-anyway-btn');
        const confirmOverrideInput = document.getElementById('confirm-override-input');
        const appointmentForm = document.getElementById('appointment-form');

        {% for message in messages %}
            {% if message.tags == 'warning' %}
                var conflictMessage = "{{ message|escapejs }}";
                document.getElementById('conflict-message').innerText = conflictMessage;
                
                // Show the modal if a warning message is present
                conflictModal.show();

                // Add event listener to the "Proceed Anyway" button
                proceedAnywayBtn.onclick = function() {
                    confirmOverrideInput.value = 'true'; // Set the hidden input value
                    conflictModal.hide(); // Hide the modal
                    appointmentForm.submit(); // Resubmit the form
                };
            {% endif %}
        {% endfor %}
    });
</script>

{%endblock%}