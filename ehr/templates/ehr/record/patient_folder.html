{%extends "base.html" %}
{%load static%}
{% block title %}PATIENT FOLDER{% endblock%}
{%block page_title%}
<div class="flex justify-center">
      PATIENT VIRTUAL FILE
      </div>
{%endblock%}
{% block content %}

<div class="">

  <section class="max-w-xl mx-auto text-center border-cyan-700 p-1 m-1">

    {% for message in messages %}
      <div class="">
        <div class="bg-green-100 rounded-2xl text-xs p-2" uk-alert>
          <a href class="uk-alert-close font-bold text-rose-900" uk-close></a>
          <p class="text-green-700  uppercase">{{ message }}</p>
        </div>
      </div>
      {% endfor %}
    </section>

    <div class="md:mx-20  mx-2 text-xs text-center">
        <!-- Warning Banner -->

  <div class="flex flex-wrap justify-center items-center mb-1 space-x-2 gap-2">
    <!-- Date Range Filter Form -->
    <form method="get" class="flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
</span>
      <div class="flex flex-col sm:flex-row sm:space-x-2 space-y-2 sm:space-y-0 w-full sm:w-auto">
            
            <div class="flex items-center w-full sm:w-auto">
                <label for="start_date" class="sr-only">Start Date</label>
                <input type="date" name="start_date" id="start_date"
                       value="{{ query|default:'' }}"
                       class="focus:ring-amber-500 focus:border-amber-500 block shadow-sm text-xs border-gray-300 rounded-md w-full sm:w-auto">
            </div>
            
            <div class="flex items-center w-full sm:w-auto">
                <label for="end_date" class="sr-only">End Date</label>
                <input type="date" name="end_date" id="end_date"
                       value="{{ query|default:'' }}"
                       class="focus:ring-amber-500 focus:border-amber-500 block shadow-sm text-xs border-gray-300 rounded-md w-full sm:w-auto">
            </div>
        </div>
        
        <div class="flex space-x-2">
            <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500">
                <i class="fas fa-search"></i>
            </button>
            
            {%if request.GET.urlencode%}
            <a href="{% url 'patient_details' patient.file_no %}" 
               class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-amber-500 hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">
                <i class="fas fa-rotate"></i>
            </a>
            <!-- PDF Export with Date Range -->
            <a href="{% url 'patient_details' patient.file_no %}?format=pdf{% if request.GET.start_date %}&start_date={{ request.GET.start_date }}{% endif %}{% if request.GET.end_date %}&end_date={{ request.GET.end_date }}{% endif %}" 
               class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                <i class="fas fa-file-pdf mr-2"></i> Export PDF
            </a>
            {%endif%}
        </div>
    </form>
            <div>
   <a href="{% url 'patient_details' patient.file_no %}?format=pdf" 
   class="uppercase inline-flex items-center gap-2 px-4 py-2.5 hover:bg-slate-700 bg-slate-100 hover:text-white text-black font-semibold text-xs rounded-lg shadow-md hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5">
  <i class="fa-solid fa-file-pdf"></i>
  Patient Summary
</a>
        </div>
</div>
{% if not has_active_visit %}
  <div class="info-box">
    <i class="fa-solid fa-triangle-exclamation"></i>
    <span class="title">🚫 Access Restricted</span>
    <span class="desc">No active visit session found. Patient interactions are disabled until payment is made for new registration or follow up.</span>
  </div>
{% endif %}

{% if has_active_visit and active_visit_for_actions %}
  <div class="visit-box flex">
    <div class="visit-tag">🔴 Active Visit Session</div>

    <div class="visit-info-section">
      <div class="visit-info">
        <strong>Visit ID:</strong> {{ active_visit_for_actions.id }}&nbsp;&nbsp;
        <strong>Started:</strong> {{ active_visit_for_actions.updated }}&nbsp;&nbsp;
        <strong>Status:</strong>
        <span class="status-pill
          {% if 'Waiting for Nurse' in active_visit_for_actions.get_status_display %} status-waiting-nurse
          {% elif 'Waiting for Doctor' in active_visit_for_actions.get_status_display %} status-waiting-doctor
          {% elif 'Awaiting Review' in active_visit_for_actions.get_status_display %} status-review
          {% elif 'Consultation Ended' in active_visit_for_actions.get_status_display %} status-ended
          {% else %} status-ok {% endif %}">
          {{ active_visit_for_actions.get_status_display }}
        </span>
      </div>
    </div>

    <button type="button" class="close-button" onclick="showVisitCloseModal('{{ active_visit_for_actions.id }}', '{{ patient.file_no }}', '{{ active_visit_for_actions.get_status_display }}', '{{ patient.first_name }} {{ patient.last_name }}')">
      <i class="fa-solid fa-door-closed" style="margin-right: 5px;"></i> Close Visit Session
    </button>

    <form id="closeVisitForm" method="POST" action="{% url 'close_visit' file_no=patient.file_no visit_pk=active_visit_for_actions.pk %}" style="display: none;">
      {% csrf_token %}
    </form>
  </div>

<div id="visitCloseModal" class="custom-modal">
  <div class="visit-modal-content">
    <div class="modal-header">
      <h2>Close Visit</h2>
      <p style="margin: 10px 0 0 0; font-size: 16px; opacity: 0.9;">Confirm closing this patient visit</p>
    </div>
    <div class="modal-body">
      <div class="warning-text">
        This will permanently close the current visit session.
      </div>
      
      <div class="visit-details" id="visitDetails">
      </div>

      <div class="consequences">
        <h4>What happens next:</h4>
        <ul>
          <li>Visit will be marked as closed</li>
          <li>Patient needs a new visit for future consultations</li>
          <li>This action cannot be undone</li>
        </ul>
      </div>

      <div class="countdown" id="visitCountdown">
        Please wait <span id="visitTimer">3</span> seconds before proceeding...
      </div>
    </div>
<div class="flex flex-col sm:flex-row gap-3 p-5">
 <button class="btn-cancel flex items-center justify-center gap-2 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white text-xs rounded-lg transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 flex-1" onclick="closeVisitModal()">
   <i class="fa-solid fa-arrow-left"></i> Keep Open
 </button>
 <button class="btn-confirm flex items-center justify-center gap-2 px-6 py-3 bg-red-500 hover:bg-red-600 disabled:bg-red-300 disabled:cursor-not-allowed text-white text-xs rounded-lg transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 disabled:hover:shadow-none disabled:hover:translate-y-0 flex-1" id="visitConfirmBtn" onclick="confirmVisitClose()" disabled>
   <i class="fa-solid fa-door-closed"></i> Close Visit
 </button>
</div>
  </div>
</div>

{% endif %}

      <div class="rounded-t-xl flex items-center gap-2 justify-between md:flex-row flex-col p-2 bg-gradient-to-r from-emerald-700 to-sky-700">
        <div>
          <h1 class="text-sm font-semibold text-gray-200 sm:mb-0 sm:mr-4 uppercase p-2">{{patient.full_name}} - {{patient.file_no}}</h1>
        </div>
        
        <div class="flex items-center uppercase">
          <span class="text-gray-200 font-bold mr-2">Wallet Balance: ₦{{ patient.wallet.balance|floatformat:2 }}</span>
          <a href="{% url 'fund_wallet' patient.id %}" class="bg-amber-600 hover:bg-amber-700 text-white font-medium py-2 px-4 rounded-full transition duration-300 ease-in-out flex items-center">
            <i class="fas fa-wallet mr-2"></i>
            Fund Wallet
          </a>
        </div>
      </div>
      <div class="text-center rounded-b-xl p-3 bg-gray-50 uppercase max-h[40vh]">
        {% if total_credit_amount > 0 %}
        <div class="bg-red-100 w-fit mx-auto rounded-xl">
          <h2 class="text-xs font-semibold text-red-700 sm:mb-0 sm:mr-4 uppercase p-2">Credit Amount: <i class="fa fa-solid fa-minus-square fa-xl"></i>&nbsp;<span class="text-sm">₦{{ total_credit_amount }}</span></h2>
          </div>
          {%endif%}
    <!-- start -->
    <!-- top  -->
    <style>
      .uk-subnav-pill > * > :first-child {
          padding: 0.25rem 1rem;
          background-color: transparent;
          transition: background-color 0.3s, color 0.3s;
      }
      .uk-subnav-pill > * > a:hover {
          background-color: rgba(6, 182, 212, 0.1);
          color: rgb(21, 94, 117);
      }
    </style>
    
      <ul class="text-xs text-cyan-700 uppercase grid md:grid-cols-8 grid-cols-3 justify-center gap-2 border-b-2 border-cyan-200 bg-gray-50 text-center p-1"uk-switcher="animation: uk-animation-slide-bottom-medium">
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">BIODATA</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">VISIT</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">PAYMENT HISTORY</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">VITAL SIGN</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">CLINICAL NOTE</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">APPOINTMENT</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">LAB REQUEST</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">LAB RESULT</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">PRESCRIPTION</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">X-RAY REQUEST</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">X-RAY REPORT</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">PHYSIO</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">ADMISSION</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">SURGERY BILL</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">IN-PATIENT</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">THEATRE</a></li>
        <li><a href="#" class="block px-3 py-2 rounded-lg bg-cyan-100 text-cyan-800 border border-cyan-200 hover:bg-cyan-200 transition-colors duration-300 font-medium shadow-sm hover:shadow-md active:bg-cyan-300 focus:outline-none focus:ring-2 focus:ring-cyan-300">FILES</a></li>
</ul>
<!-- top end  -->
    <div class="uk-switcher uk-margin ">
      <!-- break -->
      <div class=""> 
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
              <thead class="bg-cyan-50">
              <tr class=" text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">AGE</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">GENDER</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">PHONE</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">OCCUPATION</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">MARITAL STATUS</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">RELIGION</th>
                <!-- <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">TRIBE</th> -->
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">State</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">LGA</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">ADDRESS</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">NEXT OF KIN</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">RELATIONSHIP WITH NEXT OF KIN</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">NEXT OF KIN PHONE</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              <tr class="bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 text-xs">
                <td class=" p-3">{{ patient.age|default_if_none:''|upper }}</td>
                <td class=" p-3">{{ patient.gender|default_if_none:''|upper }}</td>
                <td class=" p-3">{{ patient.phone|default_if_none:''|upper }}</td>
                <td class=" p-3">{{ patient.occupation|default_if_none:''|upper }}</td>
                <td class=" p-3">{{ patient.marital_status|default_if_none:''|upper }}</td>
                <td class=" p-3">{{ patient.religion|default_if_none:''|upper }}</td>
                <!-- <td class=" p-3">{{ patient.tribe|default_if_none:''|upper }}</td> -->
                <td class=" p-3">{{patient.state|default_if_none:'N/A'}}</td>
                <td class=" p-3">{{patient.lga|default_if_none:'N/A'}}</td>
                <td class=" p-3">{{ patient.address|default_if_none:''|upper }} </td>
                <td class=" p-3">{{ patient.nok_name|default_if_none:''|upper }}  </td>
                <td class=" p-3">{{ patient.nok_rel|default_if_none:''|upper }}</td>
                <td class=" p-3">{{ patient.nok_phone|default_if_none:''|upper }}</td>
                
              </tr>
            </tbody>
          </table>
        </div>
     </div>
      <div class="">
        <div>
          <a href="{%url 'visit_record' patient.file_no%}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i></a>
        </div>        
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class=" text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">CLINIC</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">TEAM</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">REASON</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DATE</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {%for v in visits %}
              <tr class="bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 text-xs">
                <td class=" p-3">{{ v.clinic|default_if_none:''|upper}}</td>
                <td class=" p-3">{{ v.team|default_if_none:''|upper}}</td>
                <td class=" p-3">{{ v.record|default_if_none:''|upper}}</td>
                <td class=" p-3">{{ v.updated|default_if_none:''}}</td>
                
              </tr>
              {%endfor%}
            </tbody>
          </table>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
      <!-- <div> 
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">TRANSACTION</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DESCRIPTION</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">AMOUNT</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DATE</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {%for w in wallet %}
              <tr class="uppercase bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 text-xs ">
                <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                {% if w.transaction_type == 'DEBIT' %}
                <td class=" p-3 whitespace-nowrap text-red-700">
                  <i class="fa-solid fa-minus-circle text-red-700 fa-2xl"></i> {{w.transaction_type}}
                </td>
                {% else %}
                <td class=" p-3 whitespace-nowrap text-green-700">
                  <i class="fa-solid fa-plus-circle fa-2xl"></i> {{w.transaction_type}}
                </td>
                {% endif %}
                <td class=" p-3 whitespace-nowrap">{{ w.description }}</td>
                <td class=" p-3 whitespace-nowrap text-green-700">&#x20A6;{{ w.amount }}</td>
                <td class=" p-3 whitespace-nowrap text-green-700">{{ w.created_at }}</td>
              </tr>
              {%empty%}
              <div class="p-2">
                  <p>No payments found found</p>
              </div>
             {%endfor%}
            </tbody>
          </table>
        </div>
     </div> -->
    <!-- break -->
      <!-- break -->

      <!-- break -->
      <!-- break -->
      <div> 
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">SERVICE</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">PRICE</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">STATUS</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">METHOD</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DATE</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {%for p in payments %}
              <tr class="uppercase bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 text-xs ">
                <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class=" p-3 whitespace-nowrap">{{ p.service }}</td>
                <td class=" p-3 whitespace-nowrap text-green-700">&#x20A6;{{ p.price }}</td>
                {% if p.status == False %}
                <td class=" p-3 whitespace-nowrap text-red-700">
                  <i class="fa-solid fa-xmark-circle text-red-700 fa-2xl"></i>
                </td>
                {% else %}
                <td class=" p-3 whitespace-nowrap text-green-700">
                  <i class="fa-solid fa-check-circle fa-2xl"></i>
                </td>
                {% endif %}
                {% if p.payment_method == 'CREDIT' %}
                <td class=" p-3 whitespace-nowrap text-red-600"><i class="fa fa-solid fa-minus-circle fa-xl"></i>{{ p.payment_method }}<i class="fa fa-solid fa-minus-circle fa-xl"></i></td>
                {%else%}
                <td class=" p-3 whitespace-nowrap">{{ p.payment_method }}</td>
                {%endif%}
                <td class=" p-3 whitespace-nowrap">{{ p.updated }}</td>
              </tr>
              {%empty%}
              <div class="p-2">
                  <p>No payments found found</p>
              </div>
             {%endfor%}
            </tbody>
          </table>
          <div class="mt-2">
            <!-- times: {{paid_transactions_count}} -->
            <span class="uppercase text-sm">
          Total amount: <span class="text-green-700 uppercase text-sm ">
            &#x20A6;{{ total_amount|floatformat:2 }}
          </span>
        </span>
        </div>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
      <div> 
        <div>
        <a href="{%url 'vital_signs' patient.file_no%}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-heartbeat fa-2xl"></i></a>
      </div>     
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Nurse</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">body temperature</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">pulse rate</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">respiration rate</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">blood pressure</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">blood oxygen</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">blood glucose</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">weight</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">height</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {%for v in vitals %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 normal-case">
                <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class=" p-3 whitespace-nowrap uppercase">{{ v.user }}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.body_temperature %}{{ v.body_temperature|default:'' }} K{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.pulse_rate %}{{ v.pulse_rate }} BPM{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.respiration_rate %}{{ v.respiration_rate }} BPM{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.blood_pressure %}{{ v.blood_pressure }} mmHg{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.blood_oxygen %}{{ v.blood_oxygen }} %{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.blood_glucose %}{{ v.blood_glucose }} mmol/L{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.weight %}{{ v.weight }} kg{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{%if v.height %}{{ v.height }} cm{%else%}{%endif%}</td>
                <td class=" p-3 whitespace-nowrap">{{ v.updated }}</td>
              </tr>
              {%empty%}
              <div class="p-2">
                  <p>No vital signs found</p>
              </div>
         {%endfor%}
            </tbody>
          </table>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
<div> 
  <!-- Header Section -->
  <div class="flex flex-col items-center text-center mb-3 pb-2 ">
  
  {% if has_active_visit %}
    <a href="{% url 'clinical_note' patient.file_no %}" 
       class="text-xs text-green-600 hover:text-green-700">
          <i class="fa-solid fa-notes-medical text-green-600 text-2xl"></i>
    </a>
  {% else %}
    <div class="relative group">
      <button disabled 
              class="text-xs text-green-600 hover:text-green-700">
            <i class="fa-solid fa-notes-medical text-green-600 text-2xl"></i>

      </button>
<p class="bg-black text-white text-xs p-2 rounded">
  Clinical notes can only be added when the patient has an active visit session. 
</p>

    </div>
  {% endif %}
</div>



  <!-- Notes Table -->
  <div class="overflow-hidden rounded-lg border border-gray-200">
    {% if clinical_notes %}
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gradient-to-r from-green-50 to-cyan-50">
          <tr>
            <th class="p-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              #
            </th>
            <th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
              Clinical Note
            </th>
            <th class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-20">
              Update
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for c in clinical_notes %}
            <tr class="hover:bg-gray-50 transition-colors duration-200">
              <td class="text-left p-2 whitespace-nowrap text-xs font-medium text-gray-900">
                {{ forloop.counter }}
              </td>
              <td class="text-left px-3 py-2">
                <details class="group">
                  <summary class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white py-3 px-6 rounded-lg cursor-pointer transition-all duration-200 inline-flex items-center gap-2 font-medium text-xs">
                    <i class="fa-solid fa-file-medical group-open:rotate-90 transition-transform duration-200"></i>
                    Open Clinical Note: <span class="bg-white text-blue-700 p-1 rounded"> {{ c.updated }} </span>
                    <i class="fa-solid fa-chevron-down group-open:rotate-180 transition-transform duration-200 ml-auto"></i>
                  </summary>
                  
                  <div class="mt-2 bg-gray-50 rounded-lg p-2 border border-gray-200 max-h-50 overflow-y-auto">
                    <!-- Note Header -->
                    <div class="text-center grid grid-cols-3 gap-2 p-1 bg-white rounded-lg border border-gray-200">
                      <div>
                        <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Diagnosis</label>
                        <p class="text-xs text-gray-900 font-medium mt-1">
                          {{ c.diagnosis|default:'Not specified' }}
                        </p>
                      </div>

                      <div>
                        <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Doctor</label>
                        <p class="text-xs text-gray-900 font-medium mt-1">
                          Dr. {{ c.user.get_full_name|default:c.user.username }}
                        </p>
                      </div>
                      <div>
                        <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide">Date & Time</label>
                        <p class="text-xs text-gray-900 font-medium mt-1">
                          {{ c.updated }}
                        </p>
                      </div>
                      {% if c.needs_review %}
                        <div class="md:col-span-2">
                          <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            <i class="fa-solid fa-clock mr-1"></i>
                            Needs Review
                          </span>
                        </div>
                      {% endif %}
                    </div>
                    
                    <!-- Note Content -->
<!-- Note Content -->
<div class="bg-white rounded-lg p-6 border border-gray-200">
  <label class="text-xs font-semibold text-gray-600 uppercase tracking-wide mb-3 block">Clinical Notes</label>

  <div class="overflow-y-auto max-h-[50vh] border rounded-md p-3 bg-gray-50">
    <div class="prose prose-sm max-w-none text-gray-700 w-full">
      {% if c.note.html %}
        <div class="text-xs whitespace-pre-wrap text-left">
          {{ c.note.html|safe }}
        </div>
      {% else %}
        <p class="text-gray-500 italic text-xs">No clinical notes recorded</p>
      {% endif %}
    </div>
  </div>
</div>

                  </div>
                </details>
              </td>
<td class="text-left px-3 py-2 whitespace-nowrap">
  {% if c.is_editable %}
    <a href="{% url 'clinical_note_update' c.id %}" 
       class="bg-green-100 hover:bg-green-200 text-green-700 p-2 rounded-lg transition-colors duration-200 inline-flex items-center justify-center"
       title="Edit Note">
      <i class="fa-solid fa-pen text-sm"></i>
    </a>
  {% else %}
    <span class="bg-gray-100 text-gray-400 p-2 rounded-lg inline-flex items-center justify-center cursor-not-allowed"
          title="Edit window expired (30 min limit)">
      <i class="fa-solid fa-lock text-sm"></i>
    </span>
  {% endif %}
</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <!-- Empty State -->
      <div class="text-center py-12">
        <p class="text-gray-500 mb-6 text-sm">No clinical noted created for this patient yet.</p>
        {% if has_active_visit %}
          <a href="{% url 'clinical_note' patient.file_no %}" 
             class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors duration-200 inline-flex items-center gap-2 font-medium text-sm">
            <i class="fa-solid fa-plus"></i>
            Create First Clinical Note
          </a>
        {% else %}
          <p class="text-xs text-amber-600 bg-amber-50 px-4 py-2 rounded-lg inline-block">
            <i class="fa-solid fa-info-circle mr-1"></i>
            open a visit session to create clinical notes
          </p>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
    <!-- break -->
      <!-- break -->
           <!-- break -->
      <!-- break -->
      <div> 

<div class="flex flex-col items-center text-center mb-3 pb-2 ">
  
  {% if has_active_visit %}
    <a href="{% url 'new_appointment' patient.file_no %}" 
class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-calendar-week fa-2xl"></i></a>
  {% else %}
    <div class="relative group">
      <button disabled 
              class="text-xs text-green-600 hover:text-green-700">
            <i class="fa-solid fa-calendar-week fa-2xl"></i>
      </button>
<p class="bg-black text-white text-xs p-2 rounded">
  Appointments can only be added when the patient has an active visit session. 
</p>

    </div>
  {% endif %}
</div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">CLINIC</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">TEAM</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DATE</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">TIME</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DATE CONSULTED</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for a in appointments %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class=" p-3 whitespace-nowrap">{{ a.clinic }}</td>
                <td class=" p-3 whitespace-nowrap">{{ a.team|default_if_none:'' }}</td>
                <td class=" p-3 whitespace-nowrap">{{ a.date|default_if_none:'' }}</td>
                <td class=" p-3 whitespace-nowrap">{{ a.time|default_if_none:'' }}</td>
                  <td class=" p-3 whitespace-nowrap">{{ a.created_at }}</td>
                </td>
              </tr>
              {%empty%}
              <div class="p-2">
                  <p>No appointments found</p>
              </div>
         {%endfor%}
            </tbody>
          </table>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
           <!-- break -->
      <!-- break -->
      <div> 
     
<div class="flex flex-col items-center text-center mb-3 pb-2 ">
  
  {% if has_active_visit %}
    <a href="{% url 'results:lab_test' patient.file_no %}" 
class="text-xs text-green-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> SEND PATHOLOGY INVESTIGATION
        </a>
  {% else %}
    <div class="relative group">
      <button disabled 
              class="text-xs text-green-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i>
      </button>
<p class="bg-black text-white text-xs p-2 rounded">
  Investigations can only be added when the patient has an active visit session. 
</p>

    </div>
  {% endif %}
</div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">price</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">payment</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">request by</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">details</th>
          </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for s in test_items %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class=" p-3 whitespace-nowrap">&#x20A6;{{ s.total_amount }}</td>
                <td class="p-3 whitespace-nowrap">
                  {% with lab_items=s.items.all %}
                      {% if lab_items %}
                          {% with first_payment=lab_items.first.payment %}
                              {% if first_payment and first_payment.status %}
                                  <span class="text-green-500">Paid</span>
                              {% else %}
                                  <span class="text-red-500">Unpaid</span>
                              {% endif %}
                          {% endwith %}
                      {% else %}
                          <span class="text-gray-500">No Items</span>
                      {% endif %}
                  {% endwith %}
              </td>
                <td class=" p-3 whitespace-nowrap">{{ s.user }}</td>
                <td class=" p-3 whitespace-nowrap">{{ s.created }}</td>
                <td class=" p-3 whitespace-nowrap"> <a href="{% url 'results:test_detail' s.id %}" class="text-blue-500 hover:underline"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
                  </tr>
              {%empty%}
              <div class="p-2">
                  <p>No requests found</p>
              </div>
             {%endfor%}

            </tbody>
          </table>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
      <div> 
          <div class="text-center rounded-xl p-2 md:p-10 bg-gray-50">

            <!-- from here  -->
            <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-8" uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
              <li ><a href="#" class="rounded-lg ">HEMATOLOGY</a></li>
              <li><a href="#" class="rounded-lg ">CHEMICAL PATHOLOGY</a></li>
              <li class=><a href="#" class="rounded-lg ">MICROBIOLOGY</a></li>
              <li><a href="#" class="rounded-lg ">SEROLOGY</a></li>
              <li><a href="#" class="rounded-lg ">GENERAL</a></li>
            </ul>
            
            <div class="uk-switcher uk-margin">
      
              <!-- new lab -->
              <div> 
                <div class="text-center rounded-xl p-2 m-4  md:p-10 bg-gray-50">
                  <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
                    <li><a href="#" class="rounded-lg ">blood group</a></li>
                    <li><a href="#" class="rounded-lg ">genotype</a></li>
                    <li><a href="#" class="rounded-lg ">full blood count</a></li>
                  </ul>
                  
                  <div class="uk-switcher uk-margin">
             
                    <div>
                      <div>
                    <a href="{% url 'results:create_blood_group' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                        <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                    </a>
      
                      </div>
                      <div class="overflow-x-auto max-h-[50vh] p-2">
                        <table class="min-w-full divide-y divide-cyan-200 mb-4">
                          <thead class="bg-cyan-50">
                            <tr class="text-xs">
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                            </tr>
                          </thead>
                          <tbody class="bg-white divide-y divide-cyan-200">
                            {% for test_info in blood_group %}
                            <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                              <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A'}}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                              <td class="p-3 whitespace-nowrap">  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                                <i class="fa-solid fa-eye fa-2xl"></i> </a>
                                </td>            
                              </tr>
                            {%empty%}
                            <tr>
                              <td colspan="10" class="p-3 text-center">blood group test found.</td>
                          </tr>
                          {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  
                  <!-- new test -->
                  <div>
                    <div>
                  <a href="{% url 'results:create_genotype' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                      <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                  </a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                          <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
                
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {% for test_info in genotype %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                              <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                              <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                              <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                          <td class="p-3 whitespace-nowrap">  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                            <i class="fa-solid fa-eye fa-2xl"></i> </a>
                            </td>            
                          </tr>
                          {% empty %}
                          <tr>
                              <td colspan="5" class="p-3 text-center">No genotype tests available.</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                 <!-- new test   -->
                  
                  <!-- new test -->
      
                 <!-- new test   -->            
                  
                    <div>
                      <div>
                    <a href="{% url 'results:create_fbc' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                        <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                    </a>
                      </div>
                      <div class="overflow-x-auto max-h-[50vh] p-2">
                        <table class="min-w-full divide-y divide-cyan-200 mb-4">
                          <thead class="bg-cyan-50">
                  
                            <tr class="text-xs">
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                            </tr>
                  
                          </thead>
                          <tbody class="bg-white divide-y divide-cyan-200">
                            {% for test_info in fbc %}
                            <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                                <td class="p-3 whitespace-nowrap">  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs  hover:text-green-700">
                                  <i class="fa-solid fa-eye fa-2xl"></i> </a>
                            </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="p-3 text-center">No blood group tests available.</td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>  
      
      
                  
            </div>    
            </div>
             </div>
      <!-- new lab  -->      
              <!-- new lab -->
              <div> 
                <div class="text-center rounded-xl p-2 m-4  md:p-10 bg-gray-50">
                  <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
                    <li ><a href="#" class="rounded-lg ">Urea & Electrolyte/Creatinine</a></li>
                    <li><a href="#" class="rounded-lg ">Liver function</a></li>
                    <li><a href="#" class="rounded-lg ">lipid profile</a></li>
                    <li><a href="#" class="rounded-lg ">Bone chemistry</a></li>
                    <li><a href="#" class="rounded-lg ">serum proteins</a></li>
                    <li><a href="#" class="rounded-lg ">cerebo spinal fluid</a></li>
                    <li><a href="#" class="rounded-lg ">blood glucose</a></li>
                    <li><a href="#" class="rounded-lg ">miscellaneous</a></li>
                  </ul>
                  
                  <div class="uk-switcher uk-margin">
             
                    <div>
                      <div>
                    <a href="{% url 'results:create_urea_electrolyte' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                        <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                    </a>
      
                      </div>
                      <div class="overflow-x-auto max-h-[50vh] p-2">
                        <table class="min-w-full divide-y divide-cyan-200 mb-4">
                          <thead class="bg-cyan-50">
                            <tr class="text-xs">
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                            </tr>
                          </thead>
                          <tbody class="bg-white divide-y divide-cyan-200">
                            {% for test_info in urea_electrolyte %}
                            <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                              <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A'}}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                              <td class="p-3 whitespace-nowrap">  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                                <i class="fa-solid fa-eye fa-2xl"></i> </a>
                          </td>
                            </tr>
                            {%empty%}
                            <tr>
                              <td colspan="10" class="p-3 text-center">No Urea & Electrolyte test found.</td>
                          </tr>
                          {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  
                    <!-- new test -->
                  
                  <!-- new test  -->
                  <div>
                    <div>
                      <a href="{%url 'results:create_liver_function' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
        
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in liver_function %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                            <td class="p-3 whitespace-nowrap">  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i> </a>
                        </td>
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="9" class="p-3 text-center">No liver function test found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                  <!-- new test  -->
                
                  <div>
                    <div>
                      <a href="{%url 'results:create_lipid_profile' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
                
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in lipid_profile %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated }}</td>
                            <td class=" p-3 whitespace-nowrap"> <a href="{%url 'results:instance_pdf' test_info.id %}" class=" hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i></a></td>
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="7" class="p-3 text-center">No lipid profile test found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                <!-- new test  -->
      
                <!-- new test  -->
                  <div>
                    <div>
                      <a href="{%url 'results:create_bone_chemistry' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in bone_chemistry %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">  <a href="{%url 'results:instance_pdf' test_info.id %}" class=" hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i></a></td> 
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="6" class="p-3 text-center">No bone chemistry test found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                  <!-- new test  -->
                
                  <div>
                    <div>
                      <a href="{%url 'results:create_serum_proteins' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
                
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in serum_proteins %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated }}</td>
                            <td class=" p-3 whitespace-nowrap"> <a href="{%url 'results:instance_pdf'  test_info.id %}" class=" hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i></a></td>
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="7" class="p-3 text-center">No serum proteins test found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                <!-- new test  -->
      
                <!-- new test  -->
                  <div>
                    <div>
                      <a href="{%url 'results:create_cerebro_spinal_fluid' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
        
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in cerebro_spinal_fluid %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">  <a href="{%url 'results:instance_pdf' test_info.id %}" class=" hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i></a></td> 
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="6" class="p-3 text-center">No cerebo spinal fluid test found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                  <!-- new test  -->
                
                  <div>
                    <div>
                      <a href="{%url 'results:create_blood_glucose' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
                
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in blood_glucose %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated }}</td>
                            <td class=" p-3 whitespace-nowrap"> <a href="{%url 'results:instance_pdf' test_info.id %}" class=" hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i></a></td>
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="5" class="p-3 text-center">No blood glucose test found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                <!-- new test  -->
      
                <!-- new test  -->
                  <div>
                    <div>
                      <a href="{%url 'results:create_miscellaneous_chempath_tests' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                    </div>
                    <div class="overflow-x-auto max-h-[50vh] p-2">
                      <table class="min-w-full divide-y divide-cyan-200 mb-4">
                        <thead class="bg-cyan-50">
                          <tr class="text-xs">
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                            <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                          </tr>
        
                        </thead>
                        <tbody class="bg-white divide-y divide-cyan-200">
                          {%for test_info in miscellaneous_chempath_tests %}
                          <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                            <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                            <td class=" p-3 whitespace-nowrap">  <a href="{%url 'results:instance_pdf' test_info.id %}" class=" hover:text-green-700">
                              <i class="fa-solid fa-eye fa-2xl"></i></a></td> 
                          </tr>
                          {%empty%}
                          <tr>
                            <td colspan="9" class="p-3 text-center">No miscellaneous test  found.</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>  
                
                  <!-- new test  -->
                
                  
            </div>    
            </div>
      
             </div>
      <!-- new lab  -->      
      
      <!-- new lab -->
              <div> 
                <div class="text-center rounded-xl p-2 m-4  md:p-10 bg-gray-50">
                  <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
                    <li ><a href="#" class="rounded-lg ">Urine (M/C/S) </a></li>
                    <li><a href="#" class="rounded-lg ">HVS (M/C/S)</a></li>
                    <li><a href="#" class="rounded-lg ">Stool (M/C/S)</a></li>
                    <li><a href="#" class="rounded-lg ">blood culture</a></li>
                    <li><a href="#" class="rounded-lg ">occult blood</a></li>
                    <li><a href="#" class="rounded-lg ">sputum (M/C/S)</a></li>
                    <li><a href="#" class="rounded-lg ">gram stain</a></li>
                    <li><a href="#" class="rounded-lg ">swab/pus/aspirate (M/C/S)</a></li>
                    <li><a href="#" class="rounded-lg ">zn stain</a></li>
                    <li><a href="#" class="rounded-lg ">semen analysis</a></li>
                    <li><a href="#" class="rounded-lg ">urinalysis</a></li>
                    <li><a href="#" class="rounded-lg ">pregnancy test</a></li>
                  </ul>
                  
                  <div class="uk-switcher uk-margin">
             
                    <div>
                      <div>
                    <a href="{% url 'results:create_urine_microscopy' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                        <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                    </a>
      
                      </div>
                      <div class="overflow-x-auto max-h-[50vh] p-2">
                        <table class="min-w-full divide-y divide-cyan-200 mb-4">
                          <thead class="bg-cyan-50">
                            <tr class="text-xs">
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                            </tr>
                          </thead>
                          <tbody class="bg-white divide-y divide-cyan-200">
                            {% for test_info in urine_microscopy%}
                            <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                              <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A'}}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                              <td class="p-3 whitespace-nowrap">  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                                <i class="fa-solid fa-eye fa-2xl"></i> </a>
                          </td>
                            </tr>
                            {%empty%}
                            <tr>
                              <td colspan="10" class="p-3 text-center">No Urine microscopy test found.</td>
                          </tr>
                          {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                                <!-- new test  -->
                                <div>
                                  <!-- HVS Section -->
                                  <div>
                                    <a href="{% url 'results:create_hvs' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                                      <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                                    </a>
                                  </div>
                                  <div class="overflow-x-auto max-h-[50vh] p-2">
                                    <table class="min-w-full divide-y divide-cyan-200 mb-4">
                                      <thead class="bg-cyan-50">
                                        <tr class="text-xs">
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                                        </tr>
                                      </thead>
                                      <tbody class="bg-white divide-y divide-cyan-200">
                                        {% for test_info in hvs %}
                                        <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                                          <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                                          <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                                          <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                                          <td class="p-3 whitespace-nowrap">
                                            <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                                              <i class="fa-solid fa-eye fa-2xl"></i>
                                            </a>
                                          </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                          <td colspan="11" class="p-3 text-center">No HVS test found.</td>
                                        </tr>
                                        {% endfor %}
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                                
                                <!-- Stool Section -->
                                <div>
                                  <div>
                                    <a href="{% url 'results:create_stool' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
                                      <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
                                    </a>
                                  </div>
                                  <div class="overflow-x-auto max-h-[50vh] p-2">
                                    <table class="min-w-full divide-y divide-cyan-200 mb-4">
                                      <thead class="bg-cyan-50">
                                        <tr class="text-xs">
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                                          <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                                        </tr>
                                      </thead>
                                      <tbody class="bg-white divide-y divide-cyan-200">
                                        {% for test_info in stool %}
                                        <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                                          <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                                          <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                                          <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                                          <td class="p-3 whitespace-nowrap">
                                            <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                                              <i class="fa-solid fa-eye fa-2xl"></i>
                                            </a>
                                          </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                          <td colspan="12" class="p-3 text-center">No Stool test found.</td>
                                        </tr>
                                        {% endfor %}
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                                <!-- new test  -->
      
      <!-- Blood Culture Section -->
      <div>
        <div>
          <a href="{% url 'results:create_blood_culture' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in blood_culture %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="p-3 text-center">No Blood Culture test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Occult Blood Section -->
      <div>
        <div>
          <a href="{% url 'results:create_occult_blood' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in occult_blood %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="p-3 text-center">No Occult Blood test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Sputum MCS Section -->
      <div>
        <div>
          <a href="{% url 'results:create_sputum_mcs' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in sputum_mcs %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="p-3 text-center">No Sputum MCS test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Previous content remains the same -->
      
      <!-- Gram Stain Section -->
      <div>
        <div>
          <a href="{% url 'results:create_gram_stain' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in gram_stain %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="p-3 text-center">No Gram Stain test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- swab pus aspirate Section -->
      <div>
        <div>
          <a href="{% url 'results:create_swab_pus_aspirate_mcs' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in swab_pus_aspirate_mcs  %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="p-3 text-center">swab_pus_aspirate test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- ZN Stain Section -->
      <div>
        <div>
          <a href="{% url 'results:create_zn_stain' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in zn_stain %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="p-3 text-center">No ZN Stain test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Semen Analysis Section -->
      <div>
        <div>
          <a href="{% url 'results:create_semen_analysis' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in semen_analysis %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="13" class="p-3 text-center">No Semen Analysis test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Urinalysis Section -->
      <div>
        <div>
          <a href="{% url 'results:create_urinalysis' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in urinalysis %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="18" class="p-3 text-center">No Urinalysis test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Pregnancy Test Section -->
      <div>
        <div>
          <a href="{% url 'results:create_pregnancy_test' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
            <i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in pregnancy %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap">
                  <a href="{% url 'results:instance_pdf' test_info.id %}" class="text-xs hover:text-green-700">
                    <i class="fa-solid fa-eye fa-2xl"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="p-3 text-center">No Pregnancy test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
            </div>    
            </div>
      
             </div>
      
             <!-- new lab  -->      
      
             <!-- new lab -->
              <div> 
                <div class="text-center rounded-xl p-2 m-4  md:p-10 bg-gray-50">
                  <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
                    <li ><a href="#" class="rounded-lg ">MP/Widal</a></li>
                    <li><a href="#" class="rounded-lg ">Rheumatoid Factor</a></li>
                    <li><a href="#" class="rounded-lg ">Hepatitis B</a></li>
                    <li><a href="#" class="rounded-lg ">Hepatitis C</a></li>
                    <li><a href="#" class="rounded-lg ">VDRL</a></li>
                    <li><a href="#" class="rounded-lg ">Mantoux</a></li>
                    <li><a href="#" class="rounded-lg ">Aso Titre</a></li>
                    <li><a href="#" class="rounded-lg ">CRP</a></li>
                    <li><a href="#" class="rounded-lg ">HIV SCREENING</a></li>
                  </ul>
                  
                  <div class="uk-switcher uk-margin">
             
      <!-- new test  -->
      <!-- Widal Test Results -->
      <div>
        <div>
          <a href="{% url 'results:create_widal' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Code</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in widal %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{% url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700">
                  <i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="13" class="p-3 text-center">No Widal test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- new test  -->
                  
                  <!-- new test  -->
                    <div>
                      <div>
                        <a href="{%url 'results:create_rheumatoid_factor' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
                      </div>
                      <div class="overflow-x-auto max-h-[50vh] p-2">
                        <table class="min-w-full divide-y divide-cyan-200 mb-4">
                          <thead class="bg-cyan-50">
                            <tr class="text-xs">
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
                            </tr>
          
                          </thead>
                          <tbody class="bg-white divide-y divide-cyan-200">
                            {%for test_info in rheumatoid_factor %}
                            <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                              <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.id }}</td>
                              <td class=" p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                              <td class=" p-3 whitespace-nowrap">  <a href="{%url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td> 
                            </tr>
                            {%empty%}
                            <tr>
                              <td colspan="9" class="p-3 text-center">No rheumatoid factor test  found.</td>
                          </tr>
                          {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>  
                  
                    <!-- new test  -->
                  
      <!-- new test  -->
      <div>
        <div>
          <a href="{%url 'results:create_hpb' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in hpb %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{%url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="p-3 text-center">No Hepatitis B test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- new test  -->
      <div>
        <div>
          <a href="{%url 'results:create_hcv' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in hcv %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{%url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="p-3 text-center">No Hepatitis C test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- new test  -->
      
      <!-- new test  -->
      <div>
        <div>
          <a href="{% url 'results:create_vdrl' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in vdrl %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{%url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="p-3 text-center">No VDRL test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <!-- new test  -->
            
      
      <!-- Mantoux Test Results -->
      <div>
        <div>
          <a href="{% url 'results:create_mantoux' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in mantoux %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{% url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="p-3 text-center">No mantoux test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- ASO Titre Test Results -->
      <div>
        <div>
          <a href="{% url 'results:create_aso_titre' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in aso_titre %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{% url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="p-3 text-center">No ASO Titre test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- CRP Test Results -->
      <div>
        <div>
          <a href="{% url 'results:create_crp' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in crp %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{% url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="p-3 text-center">No CRP test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- HIV Screening Test Results -->
      <div>
        <div>
          <a href="{% url 'results:create_hiv_screening' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-plus fa-2xl"></i> CREATE TEMPLATE</a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">id</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for test_info in hiv_screening %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.id }}</td>
                <td class="p-3 whitespace-nowrap">{{ test_info.updated|default_if_none:'N/A' }}</td>
                <td class="p-3 whitespace-nowrap"><a href="{% url 'results:instance_pdf' test_info.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="p-3 text-center">No HIV Screening test found.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
                  
                  <!-- new test  -->
                  
            </div>    
            </div>
      
             </div>
      
             <!-- new lab  -->      
            
              <div>
                <div>
                  <a href="{% url 'results:general_test' patient.file_no %}" class="text-xs text-rose-600 hover:text-green-700"><i class="fa-solid fa-syringe fa-2xl"></i></a>
                  </div>
                  <div class="overflow-x-auto px-4 md:px-10 m-4">
                    <table class="min-w-full divide-y divide-cyan-200 mb-4">
                      <thead class="bg-cyan-50">
            
                        <tr class="text-center">
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">S/N</th>
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Test</th>
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date Collected</th>
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Result</th>
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Nature of Specimen</th>
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date Reported</th>
                          <th class="p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Edit</th>
                        </tr>
              
                      </thead>
                      <tbody class="bg-white divide-y divide-cyan-200">
                        {% for g in general_results %}
                        <tr class="bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 text-xs">
                          <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                          <td class="p-3 whitespace-nowrap">
                            {%if g.general_results.test_1 is not None %}
                            {{ g.general_results.test_1|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_2 is not None %}
                            {{ g.general_results.test_2|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_3 is not None %}
                            {{ g.general_results.test_3|default_if_none:'' }} <br>
                            {%endif%}
                            {%if g.general_results.test_4 is not None %}
                            {{ g.general_results.test_4|default_if_none:'' }} <br>
                            {%endif%}
                            
                            {%if g.general_results.test_5 is not None %}
                            {{ g.general_results.test_5|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_6 is not None %}
                            {{ g.general_results.test_6|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_7 is not None %}
                            {{ g.general_results.test_7|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_8 is not None %}
                            {{ g.general_results.test_8|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_9 is not None %}
                            {{ g.general_results.test_9|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_10 is not None %}
                            {{ g.general_results.test_10|default_if_none:'' }} <br>
                            {%endif%}
                            
                            {%if g.general_results.test_11 is not None %}
                            {{ g.general_results.test_11|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_12 is not None %}
                            {{ g.general_results.test_12|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_13 is not None %}
                            {{ g.general_results.test_13|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_14 is not None %}
                            {{ g.general_results.test_14|default_if_none:'' }} <br>
                            {%endif%}
                  
                            {%if g.general_results.test_15 is not None %}
                            {{ g.general_results.test_15|default_if_none:'' }}
                            {%endif%}
            
                                                                                          
      
                          </td>
                          <td class="p-3 whitespace-nowrap">{{ g.collected|default_if_none:'N/A' }}</td>
                          <td class="p-3 whitespace-nowrap">
                            {%if g.general_results.result_1 is not None%}
                            {{ g.general_results.result_1|default_if_none:'' }} <br>
                            {%endif%}
                            
                            {%if g.general_results.result_2 is not None%}
                            {{ g.general_results.result_2|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_3 is not None%}
                            {{ g.general_results.result_3|default_if_none:'' }}   <br>
                            {%endif%}
            
                            {%if g.general_results.result_4 is not None%}
                            {{ g.general_results.result_4|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_5 is not None%}
                            {{ g.general_results.result_5|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_6 is not None%}
                            {{ g.general_results.result_6|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_7 is not None%}
                            {{ g.general_results.result_7|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_8 is not None%}
                            {{ g.general_results.result_8|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_9 is not None%}
                            {{ g.general_results.result_9|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_10 is not None%}
                            {{ g.general_results.result_10|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_11 is not None%}
                            {{ g.general_results.result_11|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_12 is not None%}
                            {{ g.general_results.result_12|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_13 is not None%}
                            {{ g.general_results.result_13|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_14 is not None%}
                            {{ g.general_results.result_14|default_if_none:'' }} <br>
                            {%endif%}
            
                            {%if g.general_results.result_15 is not None%}
                            {{ g.general_results.result_15|default_if_none:'' }} <br>
                            {%endif%}
            
                          </td>
                          <td class="p-3 whitespace-nowrap">{{ g.general_results.nature_of_specimen|default_if_none:'N/A' }}</td>
                          {%if g.general_results.cleared %}
                          <td class=" p-3 whitespace-nowrap">{{ g.updated|default_if_none:'N/A' }}</td>
                          {%else%}
                          <td class=" p-3 whitespace-nowrap"></td>
                          {%endif%}      
                      <td class="p-3 whitespace-nowrap">
                        {%if g.payment.status == True %}
                            <a href="{% url 'results:general_result' g.patient.file_no g.general_results.id %}" class="text-green-600 hover:text-green-700"><i class="fa-solid fa-edit fa-2xl"></i></a>
                            {%else%}
                            <span class="text-rose-700">
                              UNPAID
                            </span>
                            {%endif%}
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
              </div>
              
            <!-- to here is lab  -->
      </div>
      </div>


    </div>
    <!-- break -->
      <!-- break -->
      <div> 
      
      <div class="flex justify-center gap-4 items-center text-center mb-3 pb-2 ">
  
  {% if has_active_visit %}
<a href="{% url 'pharm:add_prescription' patient.file_no  %}" class="text-xs text-green-600 hover:text-green-700 bg-green-100 p-3 rounded-xl"> 
          <i class="fa-solid fa-prescription fa-2xl"></i>
          out-patient <br>  
        </a>
        <a href="{% url 'pharm:inpatient_prescription_create' patient.file_no %}" class="text-xs text-orange-600 hover:text-orange-700 bg-orange-100 p-3 rounded-xl">
          <i class="fa-solid fa-file-prescription fa-2xl"></i>
          in-patient <br>
        </a>
  {% else %}
    <div class="relative group">
      <button disabled 
              class="text-xs text-green-600 hover:text-green-700">
          <i class="fa-solid fa-file-prescription fa-2xl"></i>
      </button>
<p class="bg-black text-white text-xs p-2 rounded">
  Prescriptions can only be added when the patient has an active visit session. 
</p>

    </div>
  {% endif %}
</div>

        <div class="overflow-x-auto max-h-[50vh] p-2">
<table class="min-w-full divide-y divide-cyan-200 mb-4">
    <thead class="bg-cyan-50">
        <tr class="text-xs">
            <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">drug</th>
            <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">dose</th>
            <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">qty</th>
            <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">pharmacy</th>
        </tr>
    </thead>
    <tbody class="bg-white divide-y divide-cyan-200">
      {% for p in prescribed_drugs %}
      <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
        <td colspan="4" class=" p-3 whitespace-nowrap">{{ forloop.counter }} {{ p.updated }}        
          <a href="{% url 'pharm:prescription_pdf' p.patient.file_no p.id %}" class="text-xs text-blue-600 hover:text-bluee-700 p-2 rounded-xl">
            <i class="fa-solid fa-file-pdf fa-2xl"></i>
          </a></td>
        {% for pd in p.prescription_drugs.all %}
        <tr class="text-xs">
          <td class=" p-3 whitespace-nowrap">{{ pd.drug.name }}</td>
          <td class=" p-3 whitespace-nowrap">{{ pd.dosage }}</td>
          <td class=" p-3 whitespace-nowrap">{{ pd.quantity }}</td>
          <td colspan="4" class=" p-3 whitespace-nowrap"> {{ p.unit }}</td>
          <td></td>
        </tr>
        {% endfor %}
      </tr>
      {%empty%}
      <div class="p-2 text-xs">
        <p>No prescriptions found</p>
      </div>
    {% endfor %}
    
    </tbody>
</table>

        </div>
     </div>
     <div> 
      <div>
        <a href="{% url 'create_radiology_req' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700">
          <i class="fa-solid fa-plus fa-2xl"></i> SEND RADIOLOGY INVESTIGATION
      </a>
    </div>     

      <div class="overflow-x-auto max-h-[50vh] p-2">
        <table class="min-w-full divide-y divide-cyan-200 mb-4">
          <thead class="bg-cyan-50">
            <tr class="text-xs">
              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">price</th>
              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">payment</th>
              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">request by</th>
              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
              <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">details</th>
        </tr>
          </thead>
          <tbody class="bg-white divide-y divide-cyan-200">
            {% for s in radiology_test_items %}
            <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
              <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
              <td class=" p-3 whitespace-nowrap">&#x20A6;{{ s.total_amount }}</td>
              <td class="p-3 whitespace-nowrap">
                {% if s.payment and s.payment.status %}
                  <span class="text-green-500">Paid</span>
                {% else %}
                  <span class="text-red-500">Unpaid</span>
                {% endif %}
              </td>
              <td class=" p-3 whitespace-nowrap">{{ s.user }}</td>
              <td class=" p-3 whitespace-nowrap">{{ s.created }}</td>
              <td class=" p-3 whitespace-nowrap"> <a href="{% url 'radiology_test_detail' s.id %}" class="text-blue-500 hover:underline"><i class="fa-solid fa-eye fa-2xl"></i></a></td>

            </tr>
            {%empty%}
            <div class="p-2">
                <p>No requests found</p>
            </div>
           {%endfor%}

          </tbody>
        </table>
      </div>
   </div>
    <!-- break -->
      <!-- break -->

      <div>
        <div>
            <a href="{% url 'radiology_result' patient.file_no %}" class="text-xs text-rose-600 hover:text-green-700"><i class="fa-solid fa-x-ray fa-2xl"></i></a>
          </div>
        <div class="overflow-x-auto max-h-[50vh] p-2">
            <table class="min-w-full divide-y divide-cyan-200 mb-4">
                <thead class="bg-cyan-50">
                    <tr class="text-xs">
                        <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                        <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Test</th>
                        <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Comment</th>
                        <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-cyan-200">
                    {% for r in radiology_results %}
                    <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                        <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                        <td class="p-3 whitespace-nowrap">{{ r.test|default_if_none:'' }}</td>
                        <td class="p-3 whitespace-nowrap">{{ r.comments.html|safe }}</td>
                        <td class="p-3 whitespace-nowrap">{{ r.updated|default_if_none:'' }}</td>
                        
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="p-3">
                            <p>No radiology test and result found</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <!-- break -->
      <!-- break -->
      <div> 
        <div>
        <a href="{% url 'physio_request' patient.file_no %}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-wheelchair fa-2xl"></i></a>
      </div>     
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">doctor</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Test</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">request date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">diagnosis</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">remark</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">comment</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">physiotherapist</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result details</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">result date</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for p in physio %}
              <tr class="text-xs uppercase bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.doctor|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.test.name|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.request_date|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.diagnosis|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.remark|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.comment.hmtl|safe|default_if_none:'' }}</td>
                <td class=" p-3 whitespace-nowrap">{{ p.physiotherapist|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.result_details|default_if_none:'' }}</td>
                <td class="p-3 whitespace-nowrap">{{ p.result_date|default_if_none:'' }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="10" class="p-3">
                    <p>No physio request information found</p>
                </td>
            </tr>
            {% endfor %}

            </tbody>
          </table>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
      <div> 
        <div>
        <a href="{%url 'admit_patient' patient.file_no %}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-bed fa-2xl"></i></a>
      </div>     
        <div class="overflow-x-auto max-h-[50vh] p-2">
          <table class="min-w-full divide-y divide-cyan-200 mb-4 uppercase">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">status</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">ward</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">price</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">bed number</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">expected days</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">total cost</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">payment status</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">admission date</th>
                <th class=" p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">discharge date</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for a in admission_info %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                  <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                  <td class="p-3 whitespace-nowrap">
                      {% if a.status == 'RECEIVED' %}
                          <span class="text-green-600">
                              on admission for 
                              <span class="text-blue-600 text-sm">
                                  ({{ a.days_on_admission }} 
                                  {% if a.days_on_admission == 1 %}day{% else %}days{% endif %})
                              </span>
                          </span>
                      {% elif a.status == 'DISCHARGE' %}
                          <span class="text-cyan-600">discharged</span>
                      {% else %}
                          <span class="text-rose-500">not accepted yet</span>
                      {% endif %}
                  </td>
                  <td class="p-3 whitespace-nowrap">{{ a.ward|default_if_none:'' }}</td>
                  <td class="p-3 whitespace-nowrap">{{ a.ward.price|default_if_none:'' }} - Per Day</td>
                  <td class="p-3 whitespace-nowrap">
                      {% if a.bed_number %}
                          <span class="text-green-600">{{ a.bed_number }}</span>
                      {% else %}
                          <span class="text-rose-500">bed not assigned yet</span>
                      {% endif %}
                  </td>
                  <td class="p-3 whitespace-nowrap">{{ a.expected_days }}</td>
                  <td class="p-3 whitespace-nowrap">{{ a.calculate_total_cost }}</td>
                  {% if a.payment.status == False %}
                  <td class="p-3 whitespace-nowrap text-green-700">
                    <i class="fa-solid fa-xmark-circle fa-xl text-rose-600"></i>
              </td>  
                  </span>
                    </td>
                    {% else %}
                    <td class="p-3 whitespace-nowrap text-green-700">
                      <i class="fa-solid fa-check-circle fa-xl text-green-600"></i>
                   </td>
                    {%endif%}
                  <td class="p-3 whitespace-nowrap">{{ a.created }}</td>
                  <td class="p-3 whitespace-nowrap">
                      {% if a.status == 'DISCHARGE' %}{{ a.updated }}{% endif %}
                  </td>
              </tr>
              {% endfor %}            </tbody>
          </table>
        </div>
     </div>
    <!-- break -->
      <!-- break -->
      <div> 
      <div class="text-center rounded-xl p-2 md:p-10 bg-gray-50">
        <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
          <li ><a href="#" class="rounded-lg ">QUICK BILLING</a></li>
          <li ><a href="#" class="rounded-lg ">STANDARD BILLING</a></li>
        </ul>
        
        <div class="uk-switcher uk-margin">
          <div> 
            <div >
            <a href="{% url 'private_surgery_bill' patient.file_no %}" class="text-xs text-rose-600 hover:text-green-700"><i class="fa-solid fa-money-check fa-2xl"></i></a>
            </div>
         
            <div class="overflow-x-auto max-h-[50vh] p-2">
              <table class="min-w-full divide-y divide-cyan-200 mb-4">
                <thead class="bg-cyan-50">
                  <tr class="text-xs">
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">price</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">payment</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">billed by</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">details</th>
                      </tr>
        
                </thead>
                <tbody class="bg-white divide-y divide-cyan-200">
                  {% for s in private_bill %}
                  <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                    <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                    <td class=" p-3 whitespace-nowrap">&#x20A6;{{ s.total_amount }}</td>
                    <td class=" p-3 whitespace-nowrap">
                      {% if s.private_items.first.payment.status %}
                      <span class="text-green-500">Paid</span>
                  {% else %}
                      <span class="text-red-500">Unpaid</span>
                  {% endif %}
                    </td>
                    <td class=" p-3 whitespace-nowrap">{{ s.user }}</td>
                    <td class=" p-3 whitespace-nowrap">{{ s.created }}</td>
                    <td class=" p-3 whitespace-nowrap"> <a href="{% url 'private_bill_detail' s.id %}" class="text-blue-500 hover:underline"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
                      </tr>
                  {%empty%}
                  <div class="p-2">
                      <p>No surgery bill found</p>
                  </div>
                 {%endfor%}
                </tbody>
              </table>
            </div>
         </div>

         <div> 
            <div >
            <a href="{% url 'surgery_bill' patient.file_no %}" class="text-xs text-rose-600 hover:text-green-700"><i class="fa-solid fa-money-check fa-2xl"></i></a>
            </div>
         
            <div class="overflow-x-auto max-h-[50vh] p-2">
              <table class="min-w-full divide-y divide-cyan-200 mb-4">
                <thead class="bg-cyan-50">
                  <tr class="text-xs">
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">price</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">payment</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">billed by</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">details</th>
                      </tr>
        
                </thead>
                <tbody class="bg-white divide-y divide-cyan-200">
                  {% for s in bills %}
                  <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                    <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                    <td class=" p-3 whitespace-nowrap">&#x20A6;{{ s.total_amount }}</td>
                    <td class=" p-3 whitespace-nowrap">
                      {% if s.items.first.payment.status %}
                      <span class="text-green-500">Paid</span>
                  {% else %}
                      <span class="text-red-500">Unpaid</span>
                  {% endif %}
                    </td>
                    <td class=" p-3 whitespace-nowrap">{{ s.user }}</td>
                    <td class=" p-3 whitespace-nowrap">{{ s.created }}</td>
                    <td class=" p-3 whitespace-nowrap"> <a href="{% url 'bill_detail' s.id %}" class="text-blue-500 hover:underline"><i class="fa-solid fa-eye fa-2xl"></i></a></td>
                      </tr>
                  {%empty%}
                  <div class="p-2">
                      <p>No surgery bill found</p>
                  </div>
                 {%endfor%}
                </tbody>
              </table>
            </div>
         </div>

        
  </div>

  </div>
     </div>

     <!-- break -->
      <!-- break -->
      <div> 
      <div class="text-center rounded-xl p-2 md:p-10 bg-gray-50">
        <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
          <li ><a href="#" class="rounded-lg ">IN-PATIENT VITAL SIGNS</a></li>
          <li class=><a href="#" class="rounded-lg ">IN-PATIENT MEDICATION</a></li>
          <li><a href="#" class="rounded-lg ">IN-PATIENT NOTES</a></li>
          <li><a href="#" class="rounded-lg ">IN-PATIENT NURSE SHIFT NOTES</a></li>
        </ul>
        
        <div class="uk-switcher uk-margin">


         <div> 
            <div >
            <a href="{% url 'ward_vital_signs' patient.file_no %}" class="text-xs text-rose-600 hover:text-green-700"><i class="fa-solid fa-heartbeat fa-2xl"></i></a>
            </div>
         
            <div class="overflow-x-auto max-h-[50vh] p-2">
              <table class="min-w-full divide-y divide-cyan-200 mb-4">
                <thead class="bg-cyan-50">
                  <tr class="text-xs">
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">body temperature</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">pulse rate</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">respiration rate</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">blood pressure</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">blood oxygen</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">blood glucose</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">weight</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">by</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                      </tr>
        
                </thead>
                <tbody class="bg-white divide-y divide-cyan-200">
                  {% for w in ward_vital_signs %}
                  <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300 normal-case">
                    <td class=" p-3 whitespace-nowrap uppercase">{{ w.user }}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.body_temperature %}{{ w.body_temperature|default:'' }} K{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.pulse_rate %}{{ w.pulse_rate }} BPM{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.respiration_rate %}{{ w.respiration_rate }} BPM{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.blood_pressure %}{{ w.blood_pressure }} mmHg{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.blood_oxygen %}{{ w.blood_oxygen }} %{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.blood_glucose %}{{ w.blood_glucose }} mmol/L{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.weight %}{{ w.weight }} kg{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{%if w.height %}{{ w.height }} m{%else%}{%endif%}</td>
                    <td class=" p-3 whitespace-nowrap">{{ w.updated }}</td>
                      </tr>
                  {%empty%}
                  <div class="p-2">
                      <p>No in-patient vitals sign found</p>
                  </div>
                 {%endfor%}
                </tbody>
              </table>
            </div>
         </div>
        
<!-- Updated dispensed tab for patient folder template -->
<!-- Updated dispensed tab for patient folder template -->
<div>
    <!-- Header with multiple options -->
    <div class="flex justify-between items-center mb-3">
        <h3 class="text-sm font-medium text-cyan-700">Ward Medications</h3>
        <div class="flex gap-2">
            <!-- Manual entry (existing) -->
            <a href="{% url 'ward_medication' patient.file_no %}" 
               class="text-xs text-cyan-600 hover:text-green-700 flex items-center gap-1 px-2 py-1 rounded hover:bg-cyan-50" 
               title="Manual Entry">
                <i class="fa-solid fa-file-prescription"></i>
                <span class="hidden sm:inline">Manual</span>
            </a>
            
            <!-- Single dispensed drug administration -->
            {% if dispensed_drugs %}
            <a href="{% url 'ward_medication_dispensed' patient.file_no %}" 
               class="text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1 px-2 py-1 rounded hover:bg-blue-50" 
               title="Single Drug Administration">
                <i class="fa-solid fa-pills"></i>
                <span class="hidden sm:inline">Single</span>
            </a>
            
            <!-- Multiple dispensed drugs administration -->
            <a href="{% url 'ward_medication_multiple' patient.file_no %}" 
               class="text-xs text-green-600 hover:text-green-700 flex items-center gap-1 px-2 py-1 rounded hover:bg-green-50" 
               title="Multiple Drug Administration">
                <i class="fa-solid fa-layer-group"></i>
                <span class="hidden sm:inline">Multiple</span>
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Available Dispensed Drugs Section -->
    {% if dispensed_drugs %}
    <div class="mb-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-3 border border-green-200">
        <h4 class="text-xs font-semibold text-green-700 mb-2 flex items-center">
            <i class="fas fa-pills mr-1 text-xs"></i> 
            Available Drugs 
            <span class="ml-2 bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-[0.6rem]">
                {{ dispensed_drugs|length }} types
            </span>
        </h4>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
            {% for drug in dispensed_drugs %}
                <div class="bg-white rounded-lg border border-green-100 p-2 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-1">
                        <div class="font-medium text-green-800 text-xs truncate flex-1">
                            {{ drug.drug_name }}
                        </div>
                        <div class="ml-2 flex flex-col items-end">
                            <span class="bg-green-100 text-green-700 px-1.5 py-0.5 rounded text-[0.6rem] font-semibold">
                                {{ drug.remaining_quantity }}
                            </span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center text-[0.6rem] text-gray-500">
                        <span>{{ drug.dispensed_date|date:"d M" }}</span>
                        <span>{{ drug.dispensed_by|truncatechars:8 }}</span>
                    </div>
                    {% if drug.remaining_quantity <= 2 %}
                    <div class="mt-1 text-[0.6rem] text-orange-600 font-medium">
                        <i class="fas fa-exclamation-triangle mr-1"></i>Low stock
                    </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        
        <!-- Quick stats -->
        <div class="mt-2 pt-2 border-t border-green-200 flex justify-between text-[0.6rem] text-green-600">
            <span>
                <i class="fas fa-check-circle mr-1"></i>
                Available: {{ dispensed_drugs|length }}
            </span>
            <span>
                <i class="fas fa-clock mr-1"></i>
                {% if dispensed_drugs %}
                    Last dispensed: {{ dispensed_drugs.0.dispensed_date|date:"d M Y" }}
                {% else %}
                    Last dispensed: Never
                {% endif %}
            </span>
        </div>
    </div>
    {% else %}
    <div class="mb-3 bg-yellow-50 rounded-lg p-3 border border-yellow-200">
        <div class="flex items-center text-yellow-700">
            <i class="fas fa-info-circle mr-2"></i>
            <span class="text-xs">No dispensed drugs available. Use manual entry or dispense drugs first.</span>
        </div>
    </div>
    {% endif %}

    <!-- Combined Administration History -->
    <div class="overflow-x-auto max-h-[50vh]">
        <table class="min-w-full divide-y divide-cyan-200">
            <thead class="bg-cyan-50">
                <tr class="text-xs">
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">
                        <i class="fas fa-pills mr-1"></i>Drug
                    </th>
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">
                        <i class="fas fa-syringe mr-1"></i>Dose/Qty
                    </th>
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">
                        <i class="fas fa-comment mr-1"></i>Comment
                    </th>
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">
                        <i class="fas fa-user mr-1"></i>By
                    </th>
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">
                        <i class="fas fa-calendar mr-1"></i>Date
                    </th>
                    <th class="p-2 text-xs font-medium text-cyan-500 uppercase tracking-wider">
                        <i class="fas fa-tag mr-1"></i>Type
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
                {% for w in combined_medications %}
                <tr class="text-xs {% if w.type == 'dispensed' %}bg-blue-50 hover:bg-blue-100{% else %}bg-cyan-50 hover:bg-cyan-100{% endif %} transition-colors duration-200">
                    <td class="p-2 whitespace-nowrap font-medium">{{ forloop.counter }}</td>
                    <td class="p-2 whitespace-nowrap">
                        <div class="flex items-center">
                            {% if w.type == 'dispensed' %}
                                <i class="fas fa-prescription-bottle-alt text-blue-500 mr-1"></i>
                            {% else %}
                                <i class="fas fa-edit text-cyan-500 mr-1"></i>
                            {% endif %}
                            {{ w.drug_name }}
                        </div>
                    </td>
                    <td class="p-2 whitespace-nowrap">
                        <span class="bg-white px-2 py-1 rounded border {% if w.type == 'dispensed' %}border-blue-200{% else %}border-cyan-200{% endif %}">
                            {{ w.dose_qty }}
                        </span>
                    </td>
                    <td class="p-2 whitespace-nowrap">
                        <span class="text-gray-600">{{ w.comments|default_if_none:'-' }}</span>
                    </td>
                    <td class="p-2 whitespace-nowrap">
                        <span class="text-gray-600">
                            {% if w.type == 'dispensed' %}
                                {{ w.user|default_if_none:'-' }}
                            {% else %}
                                {{ w.user.get_full_name|default:w.user.username|default:'-' }}
                            {% endif %}
                        </span>
                    </td>
                    <td class="p-2 whitespace-nowrap">
                        <span class="text-gray-600">{{ w.updated|date:"d M Y H:i" }}</span>
                    </td>
                    <td class="p-2 whitespace-nowrap">
                        {% if w.type == 'dispensed' %}
                            <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-[0.6rem] font-medium">
                                <i class="fas fa-prescription-bottle-alt mr-1"></i>Dispensed
                            </span>
                        {% else %}
                            <span class="bg-cyan-100 text-cyan-800 px-2 py-0.5 rounded-full text-[0.6rem] font-medium">
                                <i class="fas fa-edit mr-1"></i>Manual
                            </span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="p-4 text-center text-xs text-gray-500">
                        <i class="fas fa-info-circle mr-1"></i>
                        No medications administered yet
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>      
        
          <div>
            <div>
              <a href="{% url 'ward_notes' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-clipboard-list fa-2xl"></i></a>
            </div>
            <div class="overflow-x-auto max-h-[100vh] p-2">
              <table class="min-w-full divide-y divide-cyan-200 mb-4">
                <thead class="bg-cyan-50">
        
                  <tr class="text-xs">
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Note</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">update</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                  </tr>
        
                </thead>
                <tbody class="bg-white divide-y divide-cyan-200">
                  {% for w in ward_clinical_notes %}
                  <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                    <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                    <td class="p-3 whitespace-nowrap">
                      <details>
                        <summary class="bg-blue-600 py-2 px-4 text-white rounded-lg text-center cursor-pointer">
                          OPEN NOTE
                        </summary>
                        <div class="bg-white text-blue-600 rounded-md p-4 m-4 max-h-[50vh] overflow-y-auto overflow-x-auto">
                          <ul class="space-y-4">
                            <li class="text-xs uppercase text-left flex justify-between">
                              <div>
                                <strong class="text-blue-600">Doctor:</strong>
                                <span class="text-gray-700 font-semibold">{{ w.doctor|default:'N/A' }}</span>
                              </div>
                              <div>
                                <strong class="text-blue-600">Date:</strong>
                                <span class="text-gray-700 font-semibold">{{ w.updated }}</span>
                              </div>
                            </li>
                            <hr class="my-4 border-blue-600">
                            <li class="text-xs text-left text-gray-700 normal-case">
                              {{ w.note.html|safe }}
                            </li>
                          </ul>
                        </div>
                      </details>
                    </td>

                    <td class=" p-3 whitespace-nowrap"><a href="{%url 'ward_note_update' w.id%}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-pen-square fa-2xl"></i></a>
                    <td class=" p-3 whitespace-nowrap">{{ w.updated|default_if_none:'' }}</td>

                  </tr>
                  {%empty%}
                  <div class="p-2">
                      <p>No in-patient clinical notes found</p>
                  </div>
                 {%endfor%}
                </tbody>
              </table>
            </div>
          </div>  

          <div>
            <div>
              <a href="{% url 'ward_shift_notes' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-clipboard-list fa-2xl"></i></a>
            </div>
            <div class="overflow-x-auto max-h-[100vh] p-2">
              <table class="min-w-full divide-y divide-cyan-200 mb-4">
                <thead class="bg-cyan-50">
        
                  <tr class="text-xs">
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Note</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Update</th>
                    <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                  </tr>
        
                </thead>
                <tbody class="bg-white divide-y divide-cyan-200">
                  {% for w in ward_shift_notes %}
                  <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                    <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                    <td class="p-3 whitespace-nowrap">
                      <details>
                        <summary class="bg-blue-600 py-2 px-4 text-white rounded-lg text-center cursor-pointer">
                          OPEN NOTE
                        </summary>
                        <div class="bg-white text-blue-600 rounded-md p-4 m-4 max-h-[50vh] overflow-y-auto overflow-x-auto border border-gray-700">
                          <ul class="space-y-4 ">
                            <li class="text-xs uppercase text-left flex justify-between">
                              <div>
                                <strong class="text-blue-600">Nurse:</strong>
                                <span class="text-gray-700 font-semibold">{{ w.nurse|default:'N/A' }}</span>
                              </div>
                              <div>
                                <strong class="text-blue-600">Date:</strong>
                                <span class="text-gray-700 font-semibold">{{ w.updated }}</span>
                              </div>
                            </li>
                            <hr class="my-4 border-blue-600">
                            <li class="text-xs text-left text-gray-700 normal-case">
                              {{ w.note.html|safe }}
                            </li>
                          </ul>
                        </div>
                      </details>
                    </td>

                    <td class=" p-3 whitespace-nowrap"><a href="{%url 'ward_shift_note_update' w.id%}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-pen-square fa-2xl"></i></a>
                      <td class=" p-3 whitespace-nowrap">{{ w.updated|default_if_none:'' }}</td>

                    </tr>
                  {%empty%}
                  <div class="p-2">
                      <p>No in-patient shift notes found</p>
                  </div>
                 {%endfor%}
                </tbody>
              </table>
            </div>
          </div>  
        
  </div>

  </div>
     </div>

    <!-- break -->
    <!-- break -->
      <!-- break -->
      <div> 
        <div class="text-center rounded-xl p-2 m-4  md:p-10 bg-gray-50">
          <ul class="uk-subnav uk-subnav-pill uppercase flex justify-center gap-2 " uk-switcher="animation: uk-animation-slide-bottom-medium, uk-animation-slide-top-medium">
            <li ><a href="#" class="rounded-lg ">THEATRE BOOKINGS</a></li>
            <li><a href="#" class="rounded-lg ">OPERATION NOTES</a></li>
            <li><a href="#" class="rounded-lg ">THEATRE OPERATION RECORD</a></li>
            <li><a href="#" class="rounded-lg ">ANAESTHSIA CHECKLIST</a></li>
          </ul>
          
          <div class="uk-switcher uk-margin">
     
            <div>
              <div>
                <a href="{% url 'book_for_surgery' patient.file_no %}" class="text-xs text-cyan-600 hover:text-green-700"><i class="fa-solid fa-calendar-days fa-2xl"></i></a>
              </div>
              <div class="overflow-x-auto max-h-[50vh] p-2">
                <table class="min-w-full divide-y divide-cyan-200 mb-4">
                  <thead class="bg-cyan-50">
                    <tr class="text-xs">
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Theatre</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Team</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">DIAGNOSIS</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">OPERATION PLANNED</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">operation date</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Booked By</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date Booked</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-cyan-200">
                    {% for t in theatre_bookings %}
                    <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                      <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.theatre|default_if_none:''}}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.team|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.diagnosis|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.operation_planned|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.date|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.doctor|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.updated|default_if_none:'' }}</td>
                 
                    </tr>
                    {%empty%}
                    <div class="p-2">
                        <p>No theatre bookings found</p>
                    </div>
                   {%endfor%}
                  </tbody>
                </table>
              </div>
            </div>
          
          
            <div>
              <div>
                <a href="{% url 'operation_notes' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-clipboard-list fa-2xl"></i></a>
              </div>
              <div class="overflow-x-auto max-h-[100vh] p-2">
                <table class="min-w-full divide-y divide-cyan-200 mb-4">
                  <thead class="bg-cyan-50">
          
                    <tr class="text-xs">
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Note</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Update</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">date</th>
                    </tr>
          
                  </thead>
                  <tbody class="bg-white divide-y divide-cyan-200">
                    {% for o in operation_notes %}
                    <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                      <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                      <td class="p-3 whitespace-nowrap">
                        <details>
                          <summary class="bg-blue-600 py-2 px-4 text-white rounded-lg text-center cursor-pointer">
                            OPEN NOTE
                          </summary>
                          <div class="bg-white text-blue-600 rounded-md p-4 m-4 max-h-[50vh] overflow-y-auto overflow-x-auto">
                            <ul class="space-y-4">
                              <li class="text-xs uppercase text-left">
                                <strong class="text-blue-600">Post Op Order:</strong>
                                <span class="text-gray-700 font-semibold">{{ o.post_op_order|default:'N/A' }}</span>
                              </li>
                              <li class="text-xs uppercase text-left flex justify-between">
                                <div>
                                  <strong class="text-blue-600">Anaesthesia Used:</strong>
                                  <span class="text-gray-700 font-semibold">{{ o.type_of_anaesthesia|default:'N/A' }}</span>
                                </div>
                                <div>
                                  <strong class="text-blue-600">Findings:</strong>
                                  <span class="text-gray-700 font-semibold">{{ o.findings|default:'N/A' }}</span>
                                </div>
                              </li>
                              <li class="text-xs uppercase text-left flex justify-between">
                                <div>
                                  <strong class="text-blue-600">Surgeon:</strong>
                                  <span class="text-gray-700 font-semibold">{{ o.doctor|default:'N/A' }}</span>
                                </div>
                                <div>
                                  <strong class="text-blue-600">Date:</strong>
                                  <span class="text-gray-700 font-semibold">{{ o.updated }}</span>
                                </div>
                              </li>
                              <hr class="my-4 border-blue-600">
                              <li class="text-xs text-left text-gray-700 normal-case">
                                {{ o.notes.html|safe }}
                              </li>
                            </ul>
                          </div>
                        </details>
                      </td>
                      
                      <td class=" p-3 whitespace-nowrap"><a href="{%url 'operation_notes_update' o.id%}" class="text-xs text-green-600 hover:text-green-700"><i class="fa-solid fa-pen-square fa-2xl"></i></a>
                        <td class=" p-3 whitespace-nowrap">{{ o.updated|default_if_none:'' }}</td>

                    </tr>
                    {%empty%}
                    <div class="p-2">
                        <p>No theatre notes found</p>
                    </div>
                   {%endfor%}
                  </tbody>
                </table>
              </div>
            </div>  
          
          
            <div>
              <div>
                <a href="{% url 'theatre_operation_record' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-clipboard-list fa-2xl"></i></a>
              </div>
              <div class="overflow-x-auto max-h-[50vh] p-2">
                <table class="min-w-full divide-y divide-cyan-200 mb-4">
                  <thead class="bg-cyan-50">
          
                    <tr class="text-xs">
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">theatre</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">ward</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">diagnosis</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">operation</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">surgeon</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">assistant</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">instrument nurse</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">circulating nurse</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">anaesthetist</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">comments</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date of operation</th>
                      <th class=" p-3  text-xs font-medium text-cyan-500 uppercase tracking-wider">Date added</th>
                    </tr>
          
                  </thead>
                  <tbody class="bg-white divide-y divide-cyan-200">
                    {% for t in theatre_operation_record %}
                    <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                      <td class=" p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.theatre }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.ward }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.diagnosis }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.operation }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.surgeon }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.assistant_1 }} <br> {{t.assistant_2}}<br> {{t.assistant_3}}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.instrument_nurse|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.circulating_nurse|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.anaesthetist|default_if_none:'' }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.comments.html|safe }}</td>
                      <td class=" p-3 whitespace-nowrap">{{ t.date_of_operation|default_if_none:'' }}</td>
                    <td class=" p-3 whitespace-nowrap">{{ t.updated|default_if_none:'' }}</td>

                    </tr>
                    {%empty%}
                    <div class="p-2">
                        <p>No theatre operation records found</p>
                    </div>
                   {%endfor%}
                  </tbody>
                </table>
              </div>
            </div>  
          
          
          
          
            <div>
              <div>
                <a href="{% url 'anaesthesia_checklist' patient.file_no %}" class="text-xs text-amber-600 hover:text-green-700"><i class="fa-solid fa-clipboard-list fa-2xl"></i></a>
              </div>
              <div class="overflow-x-auto max-h-[50vh] p-2">
                <table class="min-w-full divide-y divide-cyan-200 mb-4">
                  <thead class="bg-cyan-50">
                    <tr class="text-xs">
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">#</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Doctor</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Theatre</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Ward</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Transfusion</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Dentures</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Permanent</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Temporary</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Loose Teeth</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Comment</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Illnesses</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">surgical history</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Drug history</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Social history</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">last meal</th>
                      <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider">Date</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-cyan-200">
                    {% for a in anaesthesia_checklist %}
                    <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                      <td class="p-3 whitespace-nowrap">{{ forloop.counter }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.doctor }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.theatre|default_if_none:'-' }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.ward|default_if_none:'-' }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.transfussion }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.denctures }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.permanent }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.temporary }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.lose_teeth }}</td>
                      <td class="p-3 whitespace-nowrap">{{ a.comment.html|safe }}</td>
                      <td class="p-3">
                        {% for illness in a.concurrent_medical_illnesses.all %}
                           {{ illness.illness }}
                            {% if illness.description %}
                              <div class="text-gray-600">{{ illness.description|safe|truncatewords:10 }}</div>
                            {% endif %}
                        {% endfor %}
                      </td> 
                      <td class="p-3">
                        {% for surgical in a.past_surgical_history.all %}
                            {{ surgical.surgery }}
                            {{ surgical.when }}
                            {{ surgical.where }}
                            {{ surgical.LA_GA }}
                            {{ surgical.outcome.html|safe }}
                        {% endfor %}
                      </td> 
                      <td class="p-3">
                        {% for drug in a.drug_history.all %}
                            {{ drug.medication }}
                            {{ drug.allergies }}
                            {{ drug.is_present }}
                        {% endfor %}
                      </td> 
                      <td class="p-3">
                        {% for s in a.social_history.all %}
                            {{ s.item }}
                            {{ s.quantity }}
                            {{ s.duration }}
                        {% endfor %}
                      </td> 
                      <td class="p-3">
                        {% for l in a.last_meals.all %}
                            {{ l.when }}
                            {{ l.meal_type }}
                            {{ l.quantity }}
                        {% endfor %}
                      </td> 
                      <td class="p-3 whitespace-nowrap">{{ a.updated }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                      <td colspan="15" class="p-4 text-center text-gray-500">No anaesthesia checklist records found</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>  
          
          
    </div>
  
    </div>
     </div>

         <!-- break -->
      <!-- break -->
      <div class="flex flex-col items-center">
        <div class="mb-4">
          <a href="{% url 'new_archive' patient.file_no %}" class="text-xs text-green-600 hover:text-green-700">
            <i class="fas fa-file-upload fa-2xl"></i> Upload File
          </a>
        </div>
        <div class="overflow-x-auto max-h-[50vh] p-2 w-full">
          <table class="min-w-full divide-y divide-cyan-200 mb-4 uppercase">
            <thead class="bg-cyan-50">
              <tr class="text-xs">
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider text-center">#</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider text-center">File</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider text-center">Title</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider text-center">Date</th>
                <th class="p-3 text-xs font-medium text-cyan-500 uppercase tracking-wider text-center">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-cyan-200">
              {% for a in archive %}
              <tr class="text-xs bg-cyan-100 hover:bg-cyan-200 transition-colors duration-300">
                <td class="p-3 whitespace-nowrap text-center">{{ forloop.counter }}</td>
                <td class="p-3 whitespace-nowrap text-center">
                  {% if a.file.name|lower|slice:"-3:" == 'pdf' %}
                    <a href="{{ a.file.url }}" target="_blank" class="text-blue-500 hover:text-blue-700">View PDF</a>
                  {% else %}
                    <img src="{{ a.file.url }}" alt="{{ a.title }}" style="max-width: 100px; max-height: 100px; cursor: pointer; margin: auto;" onclick="openModal('{{ a.file.url }}', '{{ a.title }}')" class="archive-image">
                  {% endif %}
                </td>
                <td class="p-3 whitespace-nowrap text-center">{{ a.title }}</td>
                <td class="p-3 whitespace-nowrap text-center">{{ a.updated}}</td>
                <td class="p-3 whitespace-nowrap text-center">
                  <a href="{% url 'update_archive' a.id %}" class="text-blue-500 hover:text-blue-700 fa-lg mr-2">
                    <i class="fas fa-edit"></i>
                  </a>
                  <a href="{% url 'delete_archive' a.id %}" class="text-red-500 hover:text-red-700 fa-lg" onclick="return confirm('Are you sure you want to delete this file?');">
                    <i class="fas fa-trash"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>      
      <!-- Modal for full-size image -->
      <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
        <div id="modalCaption"></div>
      </div>
    <!-- break -->
      <!-- break -->
    <!-- break -->
<!-- end  -->
  </div>
</div>
<style>
  .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.9);
  }

  .modal-content {
      margin: auto;
      display: block;
      width: 80%;
      max-width: 700px;
  }

  #modalCaption {
      margin: auto;
      display: block;
      width: 80%;
      max-width: 700px;
      text-align: center;
      color: #ccc;
      padding: 10px 0;
      height: 150px;
  }

  .close {
      position: absolute;
      top: 15px;
      right: 35px;
      color: #f1f1f1;
      font-size: 40px;
      font-weight: bold;
      transition: 0.3s;
  }

  .close:hover,
  .close:focus {
      color: #bbb;
      text-decoration: none;
      cursor: pointer;
  }
</style>
  <script>
let visitCountdownTimer;
let visitTimeLeft = 5;

function showVisitCloseModal(visitId, fileNo, status, patientName) {
  // Populate visit details
  document.getElementById('visitDetails').innerHTML = `
    <strong>Visit ID:</strong> ${visitId}<br>
    <strong>Patient:</strong> ${patientName} (File: ${fileNo})<br>
    <strong>Current Status:</strong> ${status}<br>
    <strong>Action:</strong> <span style="color: #dc3545; font-weight: bold;">PERMANENT CLOSURE</span>
  `;
  
  const modal = document.getElementById('visitCloseModal');
  modal.style.display = 'flex'; // Use flex to center content
  modal.classList.add('show'); // Add animation class
  document.body.style.overflow = 'hidden';
  startVisitCountdown();
}

function closeVisitModal() {
  const modal = document.getElementById('visitCloseModal');
  modal.classList.remove('show'); // Remove animation class
  
  // Wait for animation to complete before hiding
  setTimeout(() => {
    modal.style.display = 'none';
  }, 300); // Match the animation duration
  
  document.body.style.overflow = 'auto';
  resetVisitCountdown();
}

function startVisitCountdown() {
  visitTimeLeft = 3;
  const timerElement = document.getElementById('visitTimer');
  const confirmBtn = document.getElementById('visitConfirmBtn');
  const countdownDiv = document.getElementById('visitCountdown');
  
  confirmBtn.disabled = true;
  confirmBtn.style.opacity = '0.5';
  confirmBtn.style.cursor = 'not-allowed';
  
  visitCountdownTimer = setInterval(() => {
    visitTimeLeft--;
    timerElement.textContent = visitTimeLeft;
    
    if (visitTimeLeft <= 0) {
      clearInterval(visitCountdownTimer);
      confirmBtn.disabled = false;
      confirmBtn.style.opacity = '1';
      confirmBtn.style.cursor = 'pointer';
      countdownDiv.innerHTML = '✅ <strong style="color: #28a745;">You may now proceed if you are certain</strong>';
    }
  }, 1000);
}

function resetVisitCountdown() {
  if (visitCountdownTimer) {
    clearInterval(visitCountdownTimer);
  }
  visitTimeLeft = 5;
  const timerElement = document.getElementById('visitTimer');
  if (timerElement) {
    timerElement.textContent = '5';
  }
  const countdownDiv = document.getElementById('visitCountdown');
  if (countdownDiv) {
    countdownDiv.innerHTML = 'Please wait <span id="visitTimer">5</span> seconds before proceeding...';
  }
}

function confirmVisitClose() {
  // Submit the hidden form
  document.getElementById('closeVisitForm').submit();
}

// Close modal when clicking outside of it
window.onclick = function(event) {
  const modal = document.getElementById('visitCloseModal');
  if (event.target === modal) {
    closeVisitModal();
  }
}

// Prevent closing with Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    event.preventDefault();
    const modal = document.getElementById('visitCloseModal');
    if (modal && modal.classList.contains('show')) {
      // Briefly shake the modal to indicate it can't be closed this way
      const modalContent = modal.querySelector('.modal-content');
      if (modalContent) {
        modalContent.style.animation = 'none';
        setTimeout(() => {
          modalContent.style.animation = 'slideIn 0.3s ease';
        }, 10);
      }
    }
  }
});

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  // Ensure modal is properly hidden on page load
  const modal = document.getElementById('visitCloseModal');
  if (modal) {
    modal.style.display = 'none';
    modal.classList.remove('show'); // Ensure no animation class
  }
});
  </script>
<script>
  function openModal(imageUrl, imageTitle) {
      var modal = document.getElementById("imageModal");
      var modalImg = document.getElementById("modalImage");
      var captionText = document.getElementById("modalCaption");
      
      modal.style.display = "block";
      modalImg.src = imageUrl;
      captionText.innerHTML = imageTitle;
  }

  function closeModal() {
      var modal = document.getElementById("imageModal");
      modal.style.display = "none";
  }

  // Close the modal when clicking outside the image
  window.onclick = function(event) {
      var modal = document.getElementById("imageModal");
      if (event.target == modal) {
          modal.style.display = "none";
      }
  }
</script>
<style>
  /* Base styles (mobile-first approach) */
.visit-box {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 2px solid #28a745;
  border-radius: 12px;
  padding: 15px;
  margin: 10px 0;
  box-shadow: 0 6px 20px rgba(40, 167, 69, 0.15);
  position: relative;
  overflow: hidden;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 15px;
}

.visit-box::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #28a745, #20c997, #17a2b8);
  animation: pulse-glow 2s ease-in-out infinite alternate;
}

.visit-tag {
  background: linear-gradient(135deg, #28a745, #20c997);
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: bold;
  display: inline-block;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
  animation: gentle-bounce 3s ease-in-out infinite;
}

.status-pill {
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  white-space: nowrap;
}

.status-waiting-nurse { background: #ffeaa7; color: #d63031; }
.status-waiting-doctor { background: #fab1a0; color: #e17055; }
.status-review { background: #74b9ff; color: #0984e3; }
.status-ended { background: #fd79a8; color: #e84393; }
.status-ok { background: #00b894; color: white; }

.close-button {
  background: linear-gradient(135deg, #dc3545, #c82333);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
  position: relative;
  overflow: hidden;
  white-space: nowrap;
}

.close-button:hover {
  background: linear-gradient(135deg, #c82333, #bd2130);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
}

/* Info Box Styles */
.info-box {
  background: linear-gradient(to right, #fff8e1, #fff3cd);
  border-left: 6px solid #f0ad4e;
  padding: 12px 16px;
  border-radius: 12px;
  margin-bottom: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  display: flex;
  align-items: center;
  gap: 3px;
  animation: fadeIn 0.6s ease;
}

.info-box i {
  font-size: 1.5rem;
  color: #f0ad4e;
  animation: ping 2s infinite ease-in-out;
  flex-shrink: 0;
}

.info-box .title {
  color: #c9302c;
  font-weight: bold;
  font-size: 0.95rem;
  text-transform: uppercase;
  white-space: nowrap;
  flex-shrink: 0;
}

.info-box .desc {
  font-size: 0.85rem;
  color: #a94442;
  flex: 1;
}

/* Modal Styles */
.custom-modal {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
  align-items: center;
  justify-content: center;
  overflow-y: auto;
}

.custom-modal.show {
  display: flex;
  animation: fadeIn 0.3s ease;
}

.visit-modal-content {
  background: white;
  margin: 20px;
  padding: 0;
  border-radius: 15px;
  width: 95%;
  max-width: 500px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  overflow: hidden;
}

.custom-modal.show .visit-modal-content {
  animation: slideIn 0.3s ease;
}

.modal-header {
  background: linear-gradient(135deg, #dc3545, #c82333);
  color: white;
  padding: 15px;
  text-align: center;
  position: relative;
}

.modal-header::before {
  content: '⚠️';
  font-size: 35px;
  display: block;
  margin-bottom: 8px;
  animation: warning-pulse 1.5s ease-in-out infinite;
}

.modal-header h2 {
  margin: 0;
  font-size: 20px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.modal-header p {
  font-size: 14px !important;
  margin: 5px 0 0 0 !important;
}

.modal-body {
  padding: 20px;
  text-align: center;
  line-height: 1.5;
  font-size: 14px;
}

.warning-text {
  font-size: 16px;
  color: #2c3e50;
  margin-bottom: 15px;
  font-weight: 500;
}

.visit-details {
  background: #f8f9fa;
  padding: 12px;
  border-radius: 8px;
  margin: 15px 0;
  border-left: 4px solid #dc3545;
  text-align: left;
  font-size: 13px;
}

.visit-details strong {
  color: #dc3545;
}

.consequences {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 8px;
  padding: 12px;
  margin: 15px 0;
  text-align: left;
  font-size: 13px;
}

.consequences h4 {
  color: #d63031;
  margin-bottom: 8px;
  font-size: 15px;
}

.consequences ul {
  margin: 0;
  padding-left: 18px;
  color: #6c757d;
}

.consequences li {
  margin-bottom: 3px;
}

.modal-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
  justify-content: center;
  padding: 0 20px 20px;
}

.btn-cancel,
.btn-confirm {
  padding: 10px 20px;
  font-size: 14px;
  flex: none;
  width: 100%;
}

.countdown {
  font-size: 13px;
  color: #dc3545;
  font-weight: bold;
  margin-top: 8px;
}

/* Animations */
@keyframes pulse-glow {
  from { opacity: 0.7; }
  to { opacity: 1; }
}

@keyframes gentle-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-2px); }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes ping {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

@keyframes slideIn {
  from { transform: translateY(-50px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes warning-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Mobile Responsive - Info Box */
@media (max-width: 768px) {
  .info-box {
    flex-direction: column;
    text-align: center;
    gap: 8px;
  }
  
  .info-box .title,
  .info-box .desc {
    white-space: normal;
  }
}

/* Desktop Responsive - Larger Screens */
@media (min-width: 769px) {
  .visit-box {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
  }

  .visit-info-section {
    margin-left: 15px;
    margin-right: 15px;
  }

  .visit-info {
    font-size: 14px;
  }

  .status-pill {
    font-size: 12px;
  }

  .close-button {
    font-size: 12px;
  }

  .visit-modal-content {
    margin: 5% auto;
    width: 90%;
  }

  .modal-header {
    padding: 20px;
  }

  .modal-header::before {
    font-size: 40px;
    margin-bottom: 10px;
  }

  .modal-header h2 {
    font-size: 24px;
  }

  .modal-header p {
    font-size: 16px !important;
  }

  .modal-body {
    padding: 30px;
    font-size: 16px;
  }

  .warning-text {
    font-size: 18px;
    margin-bottom: 20px;
  }

  .visit-details {
    padding: 15px;
    margin: 20px 0;
    font-size: 14px;
  }

  .consequences {
    padding: 15px;
    margin: 20px 0;
    font-size: 14px;
  }

  .consequences h4 {
    font-size: 16px;
  }

  .modal-buttons {
    flex-direction: row;
    gap: 15px;
    padding: 0 30px 30px;
  }

  .btn-cancel,
  .btn-confirm {
    padding: 12px 30px;
    font-size: 16px;
    flex: 1;
    width: auto;
  }

  .countdown {
    font-size: 14px;
    margin-top: 10px;
  }
}
</style>
{% endblock %}
